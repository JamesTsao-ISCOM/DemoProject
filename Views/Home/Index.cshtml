@model Project01_movie_lease_system.Models.HomeIndexViewModel
@{
    ViewData["Title"] = "首頁";
    
    // 輔助方法 - 獲取電影類型對應的 Bootstrap 顏色
    string GetTypeColor(Project01_movie_lease_system.Models.MovieType type)
    {
        return type switch
        {
            Project01_movie_lease_system.Models.MovieType.Action => "danger",
            Project01_movie_lease_system.Models.MovieType.Comedy => "warning",
            Project01_movie_lease_system.Models.MovieType.Drama => "info",
            Project01_movie_lease_system.Models.MovieType.Horror => "dark",
            Project01_movie_lease_system.Models.MovieType.SciFi => "primary",
            Project01_movie_lease_system.Models.MovieType.Romance => "success",
            Project01_movie_lease_system.Models.MovieType.Documentary => "secondary",
            _ => "secondary"
        };
    }
    
    // 輔助方法 - 獲取電影類型的顯示名稱
    string GetTypeDisplayName(Project01_movie_lease_system.Models.MovieType type)
    {
        return type switch
        {
            Project01_movie_lease_system.Models.MovieType.Action => "動作",
            Project01_movie_lease_system.Models.MovieType.Comedy => "喜劇",
            Project01_movie_lease_system.Models.MovieType.Drama => "劇情",
            Project01_movie_lease_system.Models.MovieType.Horror => "恐怖",
            Project01_movie_lease_system.Models.MovieType.SciFi => "科幻",
            Project01_movie_lease_system.Models.MovieType.Romance => "愛情",
            Project01_movie_lease_system.Models.MovieType.Documentary => "紀錄片",
            _ => type.ToString()
        };
    }
    
    // 輔助方法 - 獲取電影類型的圖標
    string GetTypeIcon(Project01_movie_lease_system.Models.MovieType type)
    {
        return type switch
        {
            Project01_movie_lease_system.Models.MovieType.Action => "bi-lightning-charge",
            Project01_movie_lease_system.Models.MovieType.Comedy => "bi-emoji-laughing",
            Project01_movie_lease_system.Models.MovieType.Drama => "bi-heart",
            Project01_movie_lease_system.Models.MovieType.Horror => "bi-moon-stars",
            Project01_movie_lease_system.Models.MovieType.SciFi => "bi-rocket",
            Project01_movie_lease_system.Models.MovieType.Romance => "bi-heart-arrow",
            Project01_movie_lease_system.Models.MovieType.Documentary => "bi-camera-video",
            _ => "bi-film"
        };
    }
    
    // 輔助方法 - 獲取電影類型的背景顏色
    string GetTypeBgColor(Project01_movie_lease_system.Models.MovieType type)
    {
        return type switch
        {
            Project01_movie_lease_system.Models.MovieType.Action => "#e74c3c",
            Project01_movie_lease_system.Models.MovieType.Comedy => "#f39c12",
            Project01_movie_lease_system.Models.MovieType.Drama => "#3498db",
            Project01_movie_lease_system.Models.MovieType.Horror => "#9b59b6",
            Project01_movie_lease_system.Models.MovieType.SciFi => "#1abc9c",
            Project01_movie_lease_system.Models.MovieType.Romance => "#e91e63",
            Project01_movie_lease_system.Models.MovieType.Documentary => "#95a5a6",
            _ => "#6c757d"
        };
    }
}

<style>
    .hero-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 400px;
        position: relative;
        overflow: hidden;
    }
    
    .hero-content {
        position: relative;
        z-index: 2;
    }
    
    .hero-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        z-index: 1;
    }
    
    .movie-card {
        transition: all 0.3s ease;
        border: none;
        overflow: hidden;
    }
    
    .movie-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }
    
    .movie-poster {
        position: relative;
        overflow: hidden;
    }
    
    .movie-poster::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8));
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .movie-card:hover .movie-poster::after {
        opacity: 1;
    }
    
    .play-btn {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 3;
    }
    
    .movie-card:hover .play-btn {
        opacity: 1;
    }
    
    .category-badge {
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .category-badge:hover {
        transform: scale(1.05);
        background: linear-gradient(45deg, #667eea, #764ba2) !important;
        color: white !important;
    }
    
    .search-section {
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(10px);
    }
    
    .rating-stars {
        color: #ffc107;
    }
    
    .section-title {
        position: relative;
        display: inline-block;
    }
    
    .section-title::after {
        content: '';
        position: absolute;
        bottom: -5px;
        left: 0;
        width: 50px;
        height: 3px;
        background: linear-gradient(45deg, #667eea, #764ba2);
        border-radius: 2px;
    }
</style>

<!-- Hero Section -->
<section class="hero-section d-flex align-items-center text-white">
    <img src="~/assets/Test_Hero.jpg" alt="hero background" class="hero-bg">
    <div class="container hero-content">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold mb-4">歡迎來到 MovieGO</h1>
                <p class="lead mb-4">探索最新最熱門的電影，立即租借您喜愛的影片，享受絕佳的觀影體驗</p>
                <div class="d-flex gap-3 mb-4">
                    <a href="#featured-movies" class="btn btn-primary btn-lg px-4">
                        <i class="bi bi-play-circle me-2"></i>立即觀看
                    </a>
                    <a href="#movie-categories" class="btn btn-outline-light btn-lg px-4">
                        <i class="bi bi-collection me-2"></i>瀏覽電影
                    </a>
                </div>
            </div>
            <div class="col-lg-4 text-center">
                <div class="search-section p-4 rounded shadow">
                    <h5 class="text-dark mb-3">搜尋電影</h5>
                    <form action="@Url.Action("Index", "Movies")" method="get" id="homeSearchForm">
                        <div class="input-group mb-3">
                            <input type="text" name="searchTitle" class="form-control" placeholder="輸入電影名稱..." id="searchInput">
                            <button class="btn btn-primary" type="submit">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                        <div class="d-flex gap-2 justify-content-center">
                            <select name="searchType" class="form-select form-select-sm" id="typeSelect">
                                <option value="All">所有類型</option>
                                <option value="Action">動作</option>
                                <option value="Comedy">喜劇</option>
                                <option value="Drama">劇情</option>
                                <option value="Horror">恐怖</option>
                                <option value="SciFi">科幻</option>
                                <option value="Romance">愛情</option>
                                <option value="Documentary">紀錄片</option>
                            </select>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Featured Movies Section -->
<section id="featured-movies" class="py-5">
    <div class="container">
        <h2 class="section-title fw-bold mb-5">精選熱門電影</h2>
        <div class="row g-4">
            @if(Model != null && Model.FeaturedMovies != null && Model.FeaturedMovies.Any())
            {
                @foreach(var movie in Model.FeaturedMovies)
                {
                    <div class="col-lg-4 col-md-6">
                        <div class="card movie-card shadow h-100">
                            <div class="movie-poster position-relative">
                                <img src="@(string.IsNullOrEmpty(movie.ImageFileName) ? "https://picsum.photos/400/600" : Url.Content("~/uploads/movies/" + movie.ImageFileName))" 
                                     alt="@movie.Title" 
                                     class="card-img-top" 
                                     style="height: 350px; object-fit: cover;">
                                <div class="play-btn">
                                    <button class="btn btn-light btn-lg rounded-circle" onclick="window.location.href='@Url.Action("MovieDetails", "Movies", new { id = movie.Id })'">
                                        <i class="bi bi-play-fill"></i>
                                    </button>
                                </div>
                                <div class="position-absolute top-0 end-0 m-3">
                                    @{
                                        var daysSinceRelease = (DateTime.Now - movie.ReleaseDate).Days;
                                        string badge = daysSinceRelease <= 30 ? "NEW" : daysSinceRelease <= 90 ? "HOT" : "TOP";
                                        string badgeColor = daysSinceRelease <= 30 ? "success" : daysSinceRelease <= 90 ? "danger" : "warning";
                                    }
                                    <span class="badge bg-@badgeColor">@badge</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h5 class="card-title mb-0">@movie.Title</h5>
                                    <span class="badge bg-@GetTypeColor(movie.Type)">@GetTypeDisplayName(movie.Type)</span>
                                </div>
                                @{
                                    var avgRating = movie.Reviews != null && movie.Reviews.Any() ? movie.Reviews.Average(r => r.Rating) : 0;
                                    var reviewCount = movie.Reviews?.Count() ?? 0;
                                }
                                <div class="rating-stars mb-2">
                                    @for(int i = 1; i <= 5; i++)
                                    {
                                        if(i <= Math.Floor(avgRating))
                                        {
                                            <i class="bi bi-star-fill"></i>
                                        }
                                        else if(i <= avgRating)
                                        {
                                            <i class="bi bi-star-half"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-star"></i>
                                        }
                                    }
                                    <small class="text-muted ms-1">@avgRating.ToString("F1") (@reviewCount)</small>
                                </div>
                                <p class="card-text text-muted small mb-3">@(movie.Description.Length > 50 ? movie.Description.Substring(0, 50) + "..." : movie.Description)</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="fw-bold text-primary fs-5">NT$ @movie.Price</span>
                                        <small class="text-muted">/3天</small>
                                    </div>
                                    <button class="btn btn-outline-primary btn-sm" onClick="window.location.href='@Url.Action("MovieDetails", "Movies", new { id = movie.Id })'">
                                        <i class="bi bi-plus-circle me-1"></i>租借
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12">
                      <div class="alert alert-info text-center">
                            目前沒有精選電影可顯示。
                      </div>
                 </div>
            }
        </div>
        
        <div class="text-center mt-4">
            <a href="@Url.Action("Index", "Movies")" class="btn btn-outline-primary btn-lg">
                <i class="bi bi-grid me-2"></i>查看更多電影
            </a>
        </div>
    </div>
</section>

<!-- Movie Categories Section -->
<section id="movie-categories" class="py-5 bg-light">
    <div class="container">
        <h2 class="section-title fw-bold mb-5">電影類型</h2>
        <div class="row g-3">
            @if(Model != null && Model.MovieTypes != null && Model.MovieTypes.Any())
            {
                @foreach(var type in Model.MovieTypes)
                {
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                        <div class="category-badge badge bg-gradient d-block p-3 text-center" style="background: @GetTypeBgColor(type);">
                            <i class="bi @GetTypeIcon(type) fs-3 d-block mb-2"></i>
                            <span>@GetTypeDisplayName(type)</span>
                        </div>
                    </div>
                }
            }
            else
            {
                <!-- 默認顯示的電影類型 -->
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <div class="category-badge badge bg-gradient d-block p-3 text-center" style="background: #e74c3c;">
                        <i class="bi bi-lightning-charge fs-3 d-block mb-2"></i>
                        <span>動作</span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <div class="category-badge badge bg-gradient d-block p-3 text-center" style="background: #f39c12;">
                        <i class="bi bi-emoji-laughing fs-3 d-block mb-2"></i>
                        <span>喜劇</span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <div class="category-badge badge bg-gradient d-block p-3 text-center" style="background: #3498db;">
                        <i class="bi bi-heart fs-3 d-block mb-2"></i>
                        <span>劇情</span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <div class="category-badge badge bg-gradient d-block p-3 text-center" style="background: #9b59b6;">
                        <i class="bi bi-moon-stars fs-3 d-block mb-2"></i>
                        <span>恐怖</span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <div class="category-badge badge bg-gradient d-block p-3 text-center" style="background: #1abc9c;">
                        <i class="bi bi-rocket fs-3 d-block mb-2"></i>
                        <span>科幻</span>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <div class="category-badge badge bg-gradient d-block p-3 text-center" style="background: #e91e63;">
                        <i class="bi bi-heart-arrow fs-3 d-block mb-2"></i>
                        <span>愛情</span>
                    </div>
                </div>
            }
        </div>
    </div>
</section>

<!-- User Reviews Section -->
<section class="py-5" style="background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);">
    <div class="container">
        <h2 class="section-title fw-bold mb-5 text-white">用戶評價與推薦</h2>
        <div class="row g-4">
            @if(Model != null && Model.RecentReviews != null && Model.RecentReviews.Any())
            {
                @foreach(var review in Model.RecentReviews)
                {
                    <div class="col-md-4">
                        <div class="card bg-dark text-white h-100 border-0">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <img src="https://i.pravatar.cc/50?u=@review.Member.Email" alt="user" class="rounded-circle me-3" width="50" height="50">
                                    <div>
                                        <h6 class="mb-0">@review.Member.Name</h6>
                                        <small class="text-muted">@review.ReviewDate.ToString("yyyy/MM/dd")</small>
                                    </div>
                                </div>
                                <div class="rating-stars mb-3">
                                    @for(int i = 1; i <= 5; i++)
                                    {
                                        if(i <= review.Rating)
                                        {
                                            <i class="bi bi-star-fill"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-star"></i>
                                        }
                                    }
                                </div>
                                <p class="card-text">「@review.Content」</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="d-flex gap-3">
                                        <span><i class="bi bi-hand-thumbs-up text-primary"></i> @(new Random().Next(5, 25))</span>
                                        <span><i class="bi bi-chat text-info"></i> @(new Random().Next(0, 8))</span>
                                    </div>
                                    <small class="text-success">已驗證租借</small>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted">關於電影：@review.Movie.Title</small>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12">
                      <div class="alert alert-info text-center">
                            目前沒有用戶評價可顯示。
                      </div>
                 </div>
            }
        </div>
    </div>
</section>

<!-- Call to Action Section -->
<section class="py-5 bg-primary text-white text-center">
    <div class="container">
        <h2 class="mb-4">立即開始您的電影之旅</h2>
        <p class="lead mb-4">加入 MovieGO 會員，享受更多優惠和專屬內容</p>
        <div class="d-flex gap-3 justify-content-center">
            <a href="/Account/Register" class="btn btn-light btn-lg px-4">
                <i class="bi bi-person-plus me-2"></i>立即註冊
            </a>
            <a href="/Movies/" class="btn btn-outline-light btn-lg px-4">
                <i class="bi bi-collection me-2"></i>瀏覽所有電影
            </a>
        </div>
    </div>
</section>