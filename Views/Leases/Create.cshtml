@model Project01_movie_lease_system.Models.Movie
@{
    ViewData["Title"] = "租借確認 - " + Model.Title;
}

<style>
    .checkout-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px 0;
        position: relative;
        overflow: hidden;
    }
    
    .checkout-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.3);
        z-index: 1;
    }
    
    .checkout-content {
        position: relative;
        z-index: 2;
    }
    
    .checkout-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
    }
    
    .checkout-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        overflow: hidden;
        margin-bottom: 30px;
    }
    
    .card-header {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 25px 30px;
        border-bottom: 1px solid #dee2e6;
    }
    
    .card-header h4 {
        color: #2c3e50;
        font-weight: 600;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .card-body {
        padding: 30px;
    }
    
    .movie-summary {
        display: flex;
        gap: 25px;
        align-items: flex-start;
    }
    
    .movie-poster-sm {
        width: 120px;
        height: 180px;
        border-radius: 10px;
        object-fit: cover;
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        flex-shrink: 0;
    }
    
    .movie-info {
        flex: 1;
    }
    
    .movie-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 10px;
    }
    
    .movie-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 15px;
        color: #666;
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.9rem;
    }
    
    .movie-price {
        font-size: 2rem;
        font-weight: 700;
        color: #667eea;
        margin-top: 15px;
    }
    
    .rental-details {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin: 25px 0;
    }
    
    .detail-row {
        display: flex;
        justify-content: between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .detail-row:last-child {
        border-bottom: none;
        font-weight: 600;
        font-size: 1.1rem;
        color: #2c3e50;
    }
    
    .detail-label {
        color: #666;
    }
    
    .detail-value {
        color: #2c3e50;
        font-weight: 500;
    }
    
    .payment-methods {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 25px 0;
    }
    
    .payment-option {
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .payment-option:hover {
        border-color: #667eea;
        background: #f8f9ff;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
    }
    
    .payment-option.selected {
        border-color: #667eea;
        background: #f8f9ff;
    }
    
    .payment-option.selected::after {
        content: '✓';
        position: absolute;
        top: -5px;
        right: -5px;
        background: #28a745;
        color: white;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: bold;
    }
    
    .payment-icon {
        font-size: 2.5rem;
        color: #667eea;
        margin-bottom: 10px;
    }
    
    .payment-name {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 5px;
    }
    
    .payment-desc {
        font-size: 0.85rem;
        color: #666;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 8px;
        display: block;
    }
    
    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    
    .form-row {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 15px;
    }
    
    .terms-checkbox {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 25px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
    }
    
    .terms-checkbox input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: #667eea;
    }
    
    .terms-text {
        color: #666;
        font-size: 0.9rem;
    }
    
    .terms-text a {
        color: #667eea;
        text-decoration: none;
    }
    
    .terms-text a:hover {
        text-decoration: underline;
    }
    
    .checkout-actions {
        display: flex;
        gap: 15px;
        justify-content: space-between;
        align-items: center;
        margin-top: 30px;
        padding-top: 25px;
        border-top: 1px solid #e9ecef;
    }
    
    .btn-back {
        background: transparent;
        border: 2px solid #6c757d;
        color: #6c757d;
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .btn-back:hover {
        background: #6c757d;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
    }
    
    .btn-confirm {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        border: none;
        color: white;
        padding: 15px 40px;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .btn-confirm:hover {
        background: linear-gradient(135deg, #20c997 0%, #28a745 100%);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
    }
    
    .security-info {
        background: #e7f3ff;
        border: 1px solid #b8daff;
        border-radius: 10px;
        padding: 20px;
        margin: 25px 0;
        text-align: center;
    }
    
    .security-icon {
        font-size: 2rem;
        color: #0066cc;
        margin-bottom: 10px;
    }
    
    .security-text {
        color: #0066cc;
        font-size: 0.9rem;
        margin: 0;
    }
    
    .breadcrumb-custom {
        background: transparent;
        padding: 0;
        margin-bottom: 20px;
    }
    
    .breadcrumb-custom .breadcrumb-item + .breadcrumb-item::before {
        content: "›";
        color: rgba(255,255,255,0.7);
    }
    
    .breadcrumb-custom .breadcrumb-item a {
        color: rgba(255,255,255,0.8);
        text-decoration: none;
    }
    
    .breadcrumb-custom .breadcrumb-item.active {
        color: white;
    }
    
    .rental-time-info {
        margin-top: 20px;
    }
    
    .rental-time-info .alert {
        border: none;
        border-radius: 10px;
        background: #e3f2fd;
        color: #1565c0;
        padding: 15px;
        margin: 0;
    }
    
    .form-control[type="date"],
    .form-control select {
        background-color: white;
        background-image: none;
    }
    
    .form-control select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 12px center;
        background-repeat: no-repeat;
        background-size: 16px 16px;
        padding-right: 40px;
    }
</style>

<!-- Header Section -->
<section class="checkout-header">
    <div class="checkout-content">
        <div class="container">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb breadcrumb-custom">
                    <li class="breadcrumb-item">
                        <a href="@Url.Action("Index", "Home")">首頁</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="@Url.Action("Index", "Movies")">電影</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="@Url.Action("MovieDetails", "Movies", new { id = Model.Id })">@Model.Title</a>
                    </li>
                    <li class="breadcrumb-item active">租借確認</li>
                </ol>
            </nav>
            
            <h1 class="display-5 fw-bold mb-3">
                <i class="bi bi-credit-card-2-front me-3"></i>
                租借確認
            </h1>
            <p class="lead mb-0">請確認您的租借詳情並完成付款</p>
        </div>
    </div>
</section>

<!-- Main Content -->
<div class="checkout-container">
    <form id="leaseForm">
        @Html.AntiForgeryToken()
        <input type="hidden" name="MovieId" value="@Model.Id" />
        
        <div class="row">
            <!-- Left Column - Movie & Payment Info -->
            <div class="col-lg-8">
                <!-- Movie Summary Card -->
                <div class="checkout-card">
                    <div class="card-header">
                        <h4>
                            <i class="bi bi-film"></i>
                            租借項目
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="movie-summary">
                            <img src="@(string.IsNullOrEmpty(Model.ImageFileName) ? "https://picsum.photos/120/180" : Url.Content("~/uploads/movies/" + Model.ImageFileName))" 
                                 alt="@Model.Title" 
                                 class="movie-poster-sm">
                            <div class="movie-info">
                                <h3 class="movie-title">@Model.Title</h3>
                                <div class="movie-meta">
                                    <span class="meta-item">
                                        <i class="bi bi-calendar3"></i>
                                        @Model.ReleaseDate.ToString("yyyy")
                                    </span>
                                    <span class="meta-item">
                                        <i class="bi bi-tag"></i>
                                        @Model.Type
                                    </span>
                                </div>
                                <div class="movie-price">NT$ @Model.Price</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Method Card -->
                <div class="checkout-card">
                    <div class="card-header">
                        <h4>
                            <i class="bi bi-credit-card"></i>
                            付款方式
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="payment-methods">
                            <div class="payment-option" id="paymentCashOption">
                                <div class="payment-icon">
                                    <i class="bi bi-bank"></i>
                                </div>
                                <div class="payment-name">到店付款</div>
                                <div class="payment-desc">請於租借當天至指定門市付款並取貨</div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Rental Start Time -->
                <div class="checkout-card">
                    <div class="card-header">
                        <h4>
                            <i class="bi bi-calendar-event"></i>
                            租借開始時間
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">選擇開始日期</label>
                                    <input type="date" class="form-control" name="LeaseStartDate" id="leaseStartDate" 
                                           min="@DateTime.Now.ToString("yyyy-MM-dd")" 
                                           value="@DateTime.Now.ToString("yyyy-MM-dd")" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">選擇開始時間</label>
                                    <select class="form-control" name="LeaseStartTime" id="leaseStartTime" required>
                                        <option value="">請選擇時間</option>
                                        <option value="09:00">09:00</option>
                                        <option value="10:00">10:00</option>
                                        <option value="11:00">11:00</option>
                                        <option value="12:00">12:00</option>
                                        <option value="13:00">13:00</option>
                                        <option value="14:00">14:00</option>
                                        <option value="15:00">15:00</option>
                                        <option value="16:00">16:00</option>
                                        <option value="17:00">17:00</option>
                                        <option value="18:00">18:00</option>
                                        <option value="19:00">19:00</option>
                                        <option value="20:00">20:00</option>
                                        <option value="21:00">21:00</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="rental-time-info">
                            <div class="alert alert-info d-flex align-items-center">
                                <i class="bi bi-info-circle me-2"></i>
                                <div>
                                    <strong>租借時間說明：</strong><br>
                                    • 租借期限為選定開始時間後的 72 小時<br>
                                    • 最早可選擇今天開始租借<br>
                                    • 建議選擇您方便觀看的時間
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Terms & Conditions -->
                <div class="checkout-card">
                    <div class="card-body">
                        <div class="terms-checkbox">
                            <input type="checkbox" id="agreeTerms" name="AgreeTerms" required>
                            <label for="agreeTerms" class="terms-text">
                                我同意 <a href="@Url.Action("Privacy", "Home")">服務條款</a> 和 <a href="@Url.Action("Privacy", "Home")">隱私政策</a>，
                                並了解租借期限為 72 小時，逾期將產生額外費用。
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Order Summary -->
            <div class="col-lg-4">
                <!-- Order Summary Card -->
                <div class="checkout-card">
                    <div class="card-header">
                        <h4>
                            <i class="bi bi-receipt"></i>
                            訂單摘要
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="rental-details">
                            <div class="detail-row">
                                <span class="detail-label">電影租借費</span>
                                <span class="detail-value">NT$ @((int)(Model.Price/(decimal)1.05))</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">服務費</span>
                                <span class="detail-value">NT$ 0</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">稅金</span>
                                <span class="detail-value">NT$ @((int)(Model.Price - (int)(Model.Price/(decimal)1.05)))</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">總計</span>
                                <span class="detail-value text-primary">NT$ @((int)(Model.Price))</span>
                            </div>
                        </div>

                        <!-- Rental Period Info -->
                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 10px; padding: 15px; margin: 20px 0;">
                            <div style="color: #856404; font-size: 0.9rem;">
                                <strong><i class="bi bi-clock-history me-1"></i> 租借資訊</strong><br>
                                • 租借期限：72 小時<br>
                                • 開始時間：<span id="selectedDateTime">請選擇開始時間</span><br>
                                • 結束時間：<span id="endDateTime">-</span><br>
                                • 可觀看次數：無限制<br>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="checkout-actions">
            <a href="@Url.Action("MovieDetails", "Movies", new { id = Model.Id })" class="btn-back">
                <i class="bi bi-arrow-left"></i>
                返回電影頁面
            </a>
            
            <button type="submit" class="btn-confirm">
                <i class="bi bi-check-circle"></i>
                確認租借並到店付款
            </button>
        </div>
    </form>
</div>
@section Scripts {
    <script src="~/js/create_lease.js"></script>
}
